<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Webpack | ZHPER 的笔记</title><meta name="author" content="zhper"><meta name="copyright" content="zhper"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="介绍打包工具开发时，我们会使用一些技术框架（React、Vue 等）、ES6 模块化语法、Less&#x2F;Sass 等 CSS 预处理器进行开发。这些必须经过编译成浏览器能识别的 JS、CSS 等语法才能最终在浏览器中运行。 打包工具就可以帮助我们完成这些工作。除此之外，打包工具还可以帮助我们压缩代码、进行兼容性处理，以及提升性能等等。 常见的打包工具有：Grunt、Gulp、Webpack、Vite">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack">
<meta property="og:url" content="https://zhper.vercel.app/2023/02/08/webpack/index.html">
<meta property="og:site_name" content="ZHPER 的笔记">
<meta property="og:description" content="介绍打包工具开发时，我们会使用一些技术框架（React、Vue 等）、ES6 模块化语法、Less&#x2F;Sass 等 CSS 预处理器进行开发。这些必须经过编译成浏览器能识别的 JS、CSS 等语法才能最终在浏览器中运行。 打包工具就可以帮助我们完成这些工作。除此之外，打包工具还可以帮助我们压缩代码、进行兼容性处理，以及提升性能等等。 常见的打包工具有：Grunt、Gulp、Webpack、Vite">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2023-02-07T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-09T15:27:50.756Z">
<meta property="article:author" content="zhper">
<meta property="article:tag" content="Webpack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/assets/favicon/%E4%BF%9D%E5%85%BB%E6%89%8B%E5%86%8C.png"><link rel="canonical" href="https://zhper.vercel.app/2023/02/08/webpack/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Webpack',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-09 23:27:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="ZHPER 的笔记"><span class="site-name">ZHPER 的笔记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Webpack</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-02-07T16:00:00.000Z" title="Created 2023-02-08 00:00:00">2023-02-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-03-09T15:27:50.756Z" title="Updated 2023-03-09 23:27:50">2023-03-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Webpack"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><h2 id="打包工具"><a href="#打包工具" class="headerlink" title="打包工具"></a>打包工具</h2><p>开发时，我们会使用一些技术框架（React、Vue 等）、ES6 模块化语法、Less/Sass 等 CSS 预处理器进行开发。这些必须经过编译成浏览器能识别的 JS、CSS 等语法才能最终在浏览器中运行。</p>
<p>打包工具就可以帮助我们完成这些工作。除此之外，打包工具还可以帮助我们压缩代码、进行兼容性处理，以及提升性能等等。</p>
<p>常见的打包工具有：Grunt、Gulp、Webpack、Vite 等等。</p>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>Webpack 以一个或多个文件作为入口，将我们整个项目所有文件编译组合为一个或多个文件输出。输出的文件就是编译好的文件，即可以在浏览器运行的文件。我们通常将 Webpack 输出的文件叫做 <code>bundle</code>。</p>
<h3 id="项目目录"><a href="#项目目录" class="headerlink" title="项目目录"></a>项目目录</h3><p>一个典型的项目基本目录如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">	|--	src # 源码目录</span><br></pre></td></tr></table></figure>

<h3 id="下载依赖"><a href="#下载依赖" class="headerlink" title="下载依赖"></a>下载依赖</h3><p>首先初始化 npm 环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>初始化后的项目目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">	|--	src # 源码目录</span><br><span class="line">	|-- package.json</span><br></pre></td></tr></table></figure>

<p>在开发过程中，我们需要 Webpack 的基本环境，包括 <code>webpack</code> 与 <code>webpack-cli</code> 这两个依赖。由于这两个依赖仅仅是在开发环境中需要，因此我们可以使用 <code>-D</code> 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<p>下载依赖后的目录结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- node_modules # 依赖</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">	|--	src # 源码目录</span><br><span class="line">	|-- package.json</span><br></pre></td></tr></table></figure>

<h3 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h3><p>接下来我们初次尝试 Webpack 的基本操作。创建如下文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- node_modules</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">		|-- index.html</span><br><span class="line">	|--	src # 源码目录</span><br><span class="line">		|--	js # js 文件目录</span><br><span class="line">		|	|-- sum.js</span><br><span class="line">		|	|-- count.js</span><br><span class="line">		|-- main.js # 项目主文件</span><br><span class="line">	|-- package.json</span><br></pre></td></tr></table></figure>

<ul>
<li>  sum.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export default function sum(...args) &#123;</span><br><span class="line">    return args.reduce((p, c) =&gt; p + c, 0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  count.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export default function count(x, y) &#123;</span><br><span class="line">    return x - y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  main.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import sum from &#x27;./js/sum&#x27;</span><br><span class="line">import count from &#x27;./js/count&#x27;</span><br><span class="line"></span><br><span class="line">console.log(sum(1, 2, 3, 4))</span><br><span class="line">console.log(count(3, 1))</span><br></pre></td></tr></table></figure>

<ul>
<li>  index.html</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Webpack Study&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Hello Webpack&lt;/h1&gt;</span><br><span class="line">    &lt;script src=&quot;src/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>除了添加上述文件之外，我们还需要编辑一下 <code>package.json</code> 文件，修改 <code>main</code> 字段，将其指向为我们的入口文件：</p>
<ul>
<li>  package.json</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ......</span><br><span class="line">  &quot;main&quot;: &quot;./src/main.js&quot;,</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="运行-Webpack"><a href="#运行-Webpack" class="headerlink" title="运行 Webpack"></a>运行 Webpack</h3><p>在进行上述的编辑之后，如果直接打开 <code>public/index.html</code> 会发现控制台有报错信息。这是因为浏览器无法直接识别 <code>public/index.html</code> 中导入的 JS 文件中的 <code>import</code> 语句，因此我们需要使用打包工具进行编译处理。</p>
<p>我们在 <strong>项目根目录</strong> 执行下列命令，其中 <code>--mode=developmen</code> 表示当前的环境为开发环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=development</span><br></pre></td></tr></table></figure>

<p>当运行成功后，在我们的根目录下会出现 <code>dist</code> 目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- dist # 输出目录</span><br><span class="line">		|-- main.js</span><br><span class="line">	|-- node_modules</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">	|--	src # 源码目录</span><br><span class="line">	|-- package.json</span><br></pre></td></tr></table></figure>

<p>随后，我们在 <code>public/index.html</code> 文件中将导入的 JS 文件更改为打包后的 JS 文件即可运行成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Webpack Study&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Hello Webpack&lt;/h1&gt;</span><br><span class="line">    &lt;script src=&quot;../dist/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>我们将执行命令的参数修改为生产环境，重新执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=production</span><br></pre></td></tr></table></figure>

<p>执行结束后，我们发现同样生成了 <code>dist</code> 目录，但是 <code>dist/main.js</code> 中的内容不一样。这是因为在不同的环境中，打包的方式也不一样。</p>
<h2 id="基本属性"><a href="#基本属性" class="headerlink" title="基本属性"></a>基本属性</h2><ul>
<li>  entry 入口</li>
</ul>
<p>指定 Webpack 从哪个文件开始打包</p>
<ul>
<li>  output 出口</li>
</ul>
<p>指定 Webpack 打包后的文件输出在何处，以及如何命名等</p>
<ul>
<li>  loader 加载器</li>
</ul>
<p>Webpack 本身只能处理 Js、Json 等资源，需要借助 loader 才能解析其他资源</p>
<ul>
<li>  plugins 插件</li>
</ul>
<p>用于扩展 Webpack 的功能</p>
<blockquote>
<p><code>loader</code> 与 <code>webpack</code> 的区别：</p>
<ol>
<li> 作用不同</li>
</ol>
<p>Webpack 只能打包 CommonJS 规范下的 JS 文件，而包括 CSS 在内的其他类型文件是无法打包的，此时就需要使用第三方的 <code>loader</code> 帮助打包。<code>loader</code> 的作用就集中在了“转化文件”这一点上，如 <code>css-loader</code> 与 <code>style-loader</code> 可以帮助打包 CSS 文件、<code>babel-loader</code> 与 <code>babel-core</code> 可以帮助将 ES6 的代码转化为 ES5。</p>
<p><code>plugins</code> 的作用不局限于打包文件、加载资源，它的作用还包括重新定义环境变量、优化性能等等。</p>
<ol>
<li> 执行时机不同。</li>
</ol>
<p><code>loader</code> 运行在打包文件之前；<code>plugins</code> 则是在整个编译周期都可能会起作用。</p>
</blockquote>
<ul>
<li>  mode 模式</li>
</ul>
<p>指定开发模式 development 或者 生产模式 production</p>
<h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h1><h2 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h2><p>前面小节介绍了 Webpack 的基本属性：<code>entry</code>、<code>output</code>、<code>loader</code>、<code>plugin</code> 与 <code>mode</code>。我们需要在项目根目录新建 <code>webpack.config.js</code> 文件，并在其中指定这五大基本属性。</p>
<p>由于 Webpack 本身基于 Node.js 运行，因此配置文件基于 CommonJS 模块化规范，使用 <code>module.exports</code> 导出。</p>
<p>接下来我们填入五大基本属性的具体内容：</p>
<ul>
<li>  <code>entry</code></li>
</ul>
<p>入口文件就是 <code>src/main.js</code>，使用相对路径指定即可：<code>./src/main.js</code>。</p>
<ul>
<li>  <code>output</code></li>
</ul>
<p>从上一小节中可以发现，当我们没有手动配置输出信息时，会默认输出在根目录的 <code>dist</code> 目录下。此时，借助配置文件的 <code>output</code> 属性，我们可以同时指定输出的路径 <code>path</code> 与输出文件名 <code>filename</code>。</p>
<p>需要注意的是，输出的路径 <code>path</code> 只能指定绝对路径，因此此处我们需要借助 Node.js 中的 <code>path</code> 模块来指定输出路径。</p>
<p>而 <code>filename</code> 则可以指定输出文件相对于 <code>path</code> 的目录。如 <code>path</code> 指定为 <code>dist</code>，<code>filename</code> 指定为 <code>js/main.js</code>，那么最终输出文件的路径为 <code>dist/js/main.js</code>。</p>
<ul>
<li>  <code>loader</code></li>
</ul>
<p>如果有需要指定的加载器 <code>loader</code>，那么我们将其填入 <code>module.rules</code> 中。此时没有需要使用的 <code>loader</code>，因此将 <code>rules</code> 指定为空数组即可。</p>
<ul>
<li>  <code>plugins</code></li>
</ul>
<p>与 <code>loader</code> 不同，如果有需要指定的插件 <code>plugin</code>，我们直接将其填入 <code>plugins</code> 属性数组中即可。此时没有需要使用的 <code>plugin</code>，因此将 <code>plugins</code> 指定为空数组即可。</p>
<ul>
<li>  <code>mode</code></li>
</ul>
<p><code>mode</code> 主要有两种模式：开发模式 <code>development</code> 与生产模式 <code>production</code>。此处我们先指定为开发模式。</p>
<p>基本配置如下</p>
<p>当我们编辑了 Webpack 配置文件之后，如果需要执行编译命令，就不再需要像上一小节中手动输入对应的参数。只需要直接执行下列命令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<h2 id="自动清空输出目录"><a href="#自动清空输出目录" class="headerlink" title="自动清空输出目录"></a>自动清空输出目录</h2><p>在当前配置下，我们每次执行 <code>npx webpack</code> 命令，都会在输出目录下输出文件，而如果原本输出目录下有其他的文件，并不会删除。我们可以在 <code>output</code> 中添加 <code>clean: true</code> 属性实现每次打包前，自动清空输出目录：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 输出路径，注意！这里的输出路径是所有文件的输出路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>), <span class="comment">// dirname 表示当前文件的绝对路径</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;js/main.js&#x27;</span>,</span><br><span class="line">    <span class="comment">// 自动清空输出路径</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="开发模式"><a href="#开发模式" class="headerlink" title="开发模式"></a>开发模式</h2><p>开发模式即我们书写代码时所用的模式。在开发模式下，我们主要关注以下两点：</p>
<ol>
<li>将原本浏览器不能识别的代码编译为浏览器能识别运行的代码。</li>
</ol>
<p>开发时我们会使用许多样式资源、字体图标等等，这些都是 Webpack 默认不能直接处理的资源。开发模式下的 Webpack 配置首要任务就是处理这些资源。</p>
<ol>
<li>代码质量检查，树立规范代码。</li>
</ol>
<p>Webpack 可以帮助我们检查出代码的一些隐患，同时检查代码规范与格式。</p>
<h2 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h2><p>1、读取<code>webpack</code>的配置参数；</p>
<p>2、启动<code>webpack</code>，创建<code>Compiler</code>对象并开始解析项目；</p>
<p>3、从入口文件（<code>entry</code>）开始解析，并且找到其导入的依赖模块，递归遍历分析，形成依赖关系树；</p>
<p>4、对不同文件类型的依赖模块文件使用对应的<code>Loader</code>进行编译，最终转为<code>Javascript</code>文件；</p>
<p>5、整个过程中<code>webpack</code>会通过发布订阅模式，向外抛出一些<code>hooks</code>，而<code>webpack</code>的插件即可通过监听这些关键的事件节点，执行插件任务进而达到干预输出结果的目的。</p>
<h1 id="处理样式资源"><a href="#处理样式资源" class="headerlink" title="处理样式资源"></a>处理样式资源</h1><p>前面的小节已经提到，Webpack 并不能直接处理包括 CSS、Less 在内的样式资源，此时我们只有借助 <code>loader</code> 才能解析样式资源。</p>
<p>对应的 <code>loader</code> 都可以去 <a target="_blank" rel="noopener" href="https://webpack.js.org/">官方文档</a> 中查看详细的说明。</p>
<h2 id="处理-CSS-资源"><a href="#处理-CSS-资源" class="headerlink" title="处理 CSS 资源"></a>处理 CSS 资源</h2><p>其中，<code>css-loader</code> 将 CSS 资源编译为 CommonJS 的模块载入 JS 中；<code>style-loader</code> 将编译后的 CSS 模块通过创建 <code>&lt;style&gt;</code> 标签的方式添加至 HTML 文件中。</p>
<p>首先下载对应的 <code>loader</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install css-loader style-loader -D</span><br></pre></td></tr></table></figure>

<p>随后在配置文件的 <code>module</code> 属性中对 <code>loader</code> 进行配置。<code>rules</code> 数组接收对象作为元素，每个对象至少包含 <code>test</code> 与 <code>use</code> 这两个属性：</p>
<ul>
<li>  <code>test</code> 属性通过正则表达式指定检测的文件类型；</li>
<li>  <code>use</code> 属性是一个数组，<strong>逆序接收</strong> 需要用到的 <code>loader</code> 字符串。</li>
</ul>
<blockquote>
<p>由于执行顺序是从后往前，因此我们需要逆序接收 <code>loader</code> 字符串。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.css$/,</span><br><span class="line">                use: [</span><br><span class="line">                    // 从后往前执行，先执行 css-loader，再执行 style-loader</span><br><span class="line">                    &#x27;style-loader&#x27;,</span><br><span class="line">                    &#x27;css-loader&#x27;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>接下来，在 <code>src</code> 下创建 <code>css</code> 目录与文件，并在入口文件 <code>src/main.js</code> 中引入 CSS 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Code <span class="comment"># 根目录（所有指令都必须在这个目录下运行）</span></span><br><span class="line">	|-- node_modules</span><br><span class="line">	|-- public <span class="comment"># 静态资源目录</span></span><br><span class="line">	|--	src <span class="comment"># 源码目录</span></span><br><span class="line">		|-- css</span><br><span class="line">			|-- index.css</span><br><span class="line">		|-- js</span><br><span class="line">	|-- package.json</span><br><span class="line">	|-- webpack.config.js</span><br></pre></td></tr></table></figure>

<ul>
<li>  <code>src/main.js</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import <span class="built_in">sum</span> from <span class="string">&#x27;./js/sum&#x27;</span></span><br><span class="line">import count from <span class="string">&#x27;./js/count&#x27;</span></span><br><span class="line">import <span class="string">&#x27;./css/index.css&#x27;</span></span><br><span class="line"></span><br><span class="line">console.log(<span class="built_in">sum</span>(1, 2, 3, 4))</span><br><span class="line">console.log(count(3, 1))</span><br></pre></td></tr></table></figure>

<p>此时，我们执行 <code>npx webpack</code>。执行完毕后，打开 <code>public/index.html</code> 便可以发现 CSS 资源效果已经生效。</p>
<h2 id="处理-Less-资源"><a href="#处理-Less-资源" class="headerlink" title="处理 Less 资源"></a>处理 Less 资源</h2><p>如果想要处理 Less 资源，我们需要使用 <code>less-loader</code>。<code>less-loader</code> 用于将 Less 资源编译为 CSS 资源，此时我们相当于已经得到了 CSS 资源，接下来就按照处理 CSS 资源的方式进行处理即可。</p>
<p><code>less-loader</code> 用于将 Less 资源编译为 CSS 资源，但是 <code>less-loader</code> 本身依赖 <code>less</code> 进行编译。因此我们实际上需要 <code>less</code>与 <code>less-loader</code> 这两个依赖才能编译 Less 文件。</p>
<p>首先，下载对应依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install less less-loader -D</span><br></pre></td></tr></table></figure>

<p>对 less 资源进行配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="comment">// 从后往前执行，先执行 css-loader，再执行 style-loader</span></span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;less-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>此时，当我们需要使用 Less 资源时，直接引入即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import sum from &#x27;./js/sum&#x27;</span><br><span class="line">import count from &#x27;./js/count&#x27;</span><br><span class="line">import &#x27;./css/index.css&#x27;</span><br><span class="line">import &#x27;./less/index.less&#x27;</span><br><span class="line"></span><br><span class="line">console.log(sum(1, 2, 3, 4))</span><br><span class="line">console.log(count(3, 1))</span><br></pre></td></tr></table></figure>

<h2 id="处理-Sass-Scss-资源"><a href="#处理-Sass-Scss-资源" class="headerlink" title="处理 Sass/ Scss 资源"></a>处理 Sass/ Scss 资源</h2><p>类似于 less , 我们下载 <code>sass</code> 与 <code>sass-loader</code> 对 Sass/Scss 资源进行编译：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install sass sass-loader -D</span><br></pre></td></tr></table></figure>

<p>对 Sass/Scss 资源进行 <code>loader</code> 配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">				<span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>],</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="处理图片资源"><a href="#处理图片资源" class="headerlink" title="处理图片资源"></a>处理图片资源</h1><p>在 Webpack5 以前，需要 <code>file-loader</code> 与 <code>url-loader</code> 才能处理图片资源。而现在 Webpack5 已经将这两个 <code>loader</code> 内置在了 Webpack 中，因此不再需要单独下载。</p>
<h2 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h2><p>与前面处理 CSS 资源类似，我们也需要在 <code>module.rules</code> 对图片资源的处理进行配置，但是略有不同。</p>
<p>我们仍然使用 <code>test</code> 对文件类型进行检测，但是不再使用 <code>use</code> 指定 <code>loader</code>，而是使用 <code>type</code> 属性，将这些文件类型指定为 <code>asset</code>。</p>
<p>如下面的代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">				<span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时我们就可以正常使用图片资源了。（比如在 CSS 中指定背景图片等）</p>
<p>实际上，我们如果不做上面这些配置，依然能打包成功，图片会输出到 dist 中</p>
<p>我们导入图片资源后，再执行 <code>npx webpack</code> 命令后会发现，输出目录 <code>dist</code> 下多了我们导入的那几张图片。</p>
<p>那么为什么之前的样式资源没有单独输出为文件呢？因为处理样式资源所使用的 <code>style-loader</code> 将最终的 CSS 资源嵌入到了输出文件 <code>dist/main.js</code> 中。</p>
<h2 id="图片资源的优化"><a href="#图片资源的优化" class="headerlink" title="图片资源的优化"></a>图片资源的优化</h2><p>有的时候，我们可能希望图片资源并不单独作为文件请求，而是转化为 Base64 格式嵌入代码文件中。</p>
<p>我们可以在 <code>rules</code> 中添加 <code>parser.dataUrlCondition.maxSize</code> 属性，用于表示当图片资源的大小小于这个值时，将其转化为 Base64 嵌入代码文件中；否则，作为单独的图片资源使用。</p>
<p>如下面的代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">				<span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">				<span class="attr">parser</span>: &#123;</span><br><span class="line">					<span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">						<span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于 10 kb 的图片将会被转化为 Base64</span></span><br><span class="line">					&#125;,</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="图片资源的打包路径"><a href="#图片资源的打包路径" class="headerlink" title="图片资源的打包路径"></a>图片资源的打包路径</h2><p>我们可以在 <code>generator.filename</code> 中指定图片资源的打包路径，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filename</span>: <span class="string">&#x27;imgs/[hash][ext][query]&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>  imgs 就是输出的路径</li>
<li>  hash 就是根据文件内容生产的一个唯一的 ID</li>
<li>  ext 就是文件的扩展名，之前的是什么就是什么</li>
<li>  query 就是查询参数，如果之前在写 url 地址带了一些查询参数就会携带上</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">				<span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">				<span class="attr">parser</span>: &#123;</span><br><span class="line">					<span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">						<span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于 10 kb 的图片将会被转化为 Base64</span></span><br><span class="line">					&#125;,</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">generator</span>: &#123;</span><br><span class="line">					<span class="attr">filename</span>: <span class="string">&#x27;imgs/[hash:8][ext]&#x27;</span>,</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，<code>[hash:8]</code> 表示打包资源的哈希值取 8 位；<code>[ext]</code> 表示资源打包之前的扩展名。</p>
<h1 id="处理音视频等资源"><a href="#处理音视频等资源" class="headerlink" title="处理音视频等资源"></a>处理音视频等资源</h1><p>与处理图片资源类似，我们使用 <code>type</code> 属性而非 <code>use</code> 属性指定处理包括字体图标、音乐、视频资源的方式。</p>
<p>字体图标可以在<a target="_blank" rel="noopener" href="https://www.iconfont.cn/">阿里巴巴矢量图标库</a> 等网站中下载</p>
<p>但是与处理图片资源不一样的地方是，我们需要将这些资源的 <code>type</code> 属性指定为 <code>asset/resource</code>，而非 <code>asset</code>。不过，我们同样可以在 <code>generator.filename</code> 属性中指定输出路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?|map4|map3|avi)$/</span>,</span><br><span class="line">				<span class="attr">type</span>: <span class="string">&#x27;asset./resource&#x27;</span>,</span><br><span class="line">				<span class="attr">generator</span>: &#123;</span><br><span class="line">					<span class="attr">filename</span>: <span class="string">&#x27;media/[hash:8][ext]&#x27;</span>,</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  asset 在小于某个文件大小会转换成 base 64</li>
<li>  而字体图标等不需要转换，只需要原封不动输出，即使用 asset/resource</li>
</ul>
<h1 id="处理-JS-资源"><a href="#处理-JS-资源" class="headerlink" title="处理 JS 资源"></a>处理 JS 资源</h1><p>Webpack 对 JS 的处理十分有限，有许多语法不能进行编译，Webpack 可以帮助做一些兼容性处理。</p>
<p>除此之外，开发团队对代码格式可能会有一定的要求，但是我们并不能总是用肉眼与检查代码格式，应该使用专业的工具来检测。</p>
<p>针对以上两点，可以在 Webpack 中分别引入 Babel 与 ESLint 来进行处理。</p>
<p>在实际的开发中，我们首先使用 ESLint 来检测代码格式，再通过 Babel 做代码的兼容性处理。</p>
<h2 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h2><p>ESLint 可以帮助我们检测 JS 和 JSX 语法，并配置各项功能。使用 ESLint 的核心在于书写 ESLint 配置文件，向其中添加各种规则进行约束，这样当我们运行 ESLint 时就会根据我们指定的规则对代码进行检测。</p>
<h3 id="ESLint-配置文件"><a href="#ESLint-配置文件" class="headerlink" title="ESLint 配置文件"></a>ESLint 配置文件</h3><p>ESLint 的配置文件有很多写法：</p>
<ol>
<li><p><code>.eslintrc.*</code> 类型：在项目根目录新建这种类型的文件，可以使用下面三种：</p>
<ul>
<li><p><code>.eslintrc</code></p>
</li>
<li><p><code>.eslintrc.js</code></p>
</li>
<li><p><code>.eslintrc.json</code></p>
</li>
</ul>
</li>
</ol>
<p>这三种的区别在于配置的书写格式不一样。</p>
<ol>
<li>在 <code>package.json</code> 中配置 <code>eslintConfig</code></li>
</ol>
<p>当我们运行时，ESLint 会查找并自动读取它们，因此上面的这些配置文件只需要存在一个。</p>
<h3 id="ESLint-基本配置"><a href="#ESLint-基本配置" class="headerlink" title="ESLint 基本配置"></a>ESLint 基本配置</h3><p>以编写 <code>.eslintrc.js</code> 配置文件为例。</p>
<p>基本的 ESLint 规则包括解析选项 <code>parserOptions</code>、检查规则 <code>rules</code>、继承规则 <code>extends</code>、环境变量 <code>env</code>，其他规则详见 <a target="_blank" rel="noopener" href="https://eslint.org/docs/latest/user-guide/configuring">官方文档</a>。</p>
<p>如下代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">parserOptions</span>: &#123;&#125;,</span><br><span class="line">	<span class="attr">rules</span>: &#123;&#125;,</span><br><span class="line">	<span class="attr">extends</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="parserOptions"><a href="#parserOptions" class="headerlink" title="parserOptions"></a>parserOptions</h4><p>基本的解析选项包括指定 ES 语法版本 <code>ecmaVersion</code>、ES 模块化类型 <code>sourceType</code>、ES 其他特性 <code>ecmaFeatures</code>（比如是否使用 jsx）。</p>
<p>如下代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">        <span class="attr">ecmaVersion</span>: <span class="number">6</span>,  <span class="comment">//ES 语法版本</span></span><br><span class="line">        <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span>,  <span class="variable constant_">ES</span> 模块化</span><br><span class="line">        <span class="attr">ecmaFeatures</span>: &#123; 其他特性</span><br><span class="line">            <span class="attr">jsx</span>: <span class="literal">true</span> 如果是 react项目，需要开启 jsx 语法</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="rules"><a href="#rules" class="headerlink" title="rules"></a>rules</h4><p>对于具体规则 <code>rules</code>，我们需要着重关注规则的开启程度：</p>
<ol>
<li><code>off</code> 或 <code>0</code>：表示关闭此条规则；</li>
<li><code>warn</code> 或 <code>1</code>：表示开启此条规则，但是使用警告提醒，这不会导致程序中断退出。</li>
<li><code>error</code> 或 <code>2</code>：表示开启此条规则，但是使用错误提醒，当此条规则触发时，程序将会中断退出。</li>
</ol>
<p>具体规则 <code>rules</code> 包含的内容很多，可以参见 <a target="_blank" rel="noopener" href="https://eslint.org/docs/latest/rules/">官方文档</a>，此处列举几例：</p>
<ul>
<li>  使用分号 <code>semi</code>；</li>
<li>  禁止与 <code>-0</code> 进行比较 <code>no-compare-neg-zero</code>。</li>
</ul>
<p>如下代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">rules</span>: &#123;</span><br><span class="line">		<span class="attr">semi</span>: <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;no-compare-neg-zero&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h4><p>在实际开发中，一条一条指定 <code>rules</code> 效率很低，所以通常会选择继承现有的规则。如 React Cli 官方的规则：<code>react-app</code>。</p>
<p>如下代码所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    extends: [&#x27;react-app&#x27;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="env"><a href="#env" class="headerlink" title="env"></a>env</h4><p>我们主要需要指定项目代码中是否可以使用 Node 以及浏览器中的全局变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    env: &#123;</span><br><span class="line">        node: true,</span><br><span class="line">        browser: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在-Webpack-中使用-ESLint"><a href="#在-Webpack-中使用-ESLint" class="headerlink" title="在 Webpack 中使用 ESLint"></a>在 Webpack 中使用 ESLint</h3><p>首先，下载依赖 <code>eslint</code> 与 <code>eslint-webpack-plugin</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint eslint-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>然后，在项目根目录新建配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- node_modules</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">	|--	src # 源码目录</span><br><span class="line">	|-- package.json</span><br><span class="line">	|-- webpack.config.js</span><br><span class="line">	|-- .eslintrc.js</span><br></pre></td></tr></table></figure>

<p>再编写简单的配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    extends: [&#x27;eslint:recommended&#x27;],</span><br><span class="line">    env: &#123;</span><br><span class="line">        node: true,</span><br><span class="line">        browser: true</span><br><span class="line">    &#125;,</span><br><span class="line">    parserOptions: &#123;</span><br><span class="line">        ecmaVersion: 6,</span><br><span class="line">        sourceType: &#x27;module&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    rules: &#123;</span><br><span class="line">        &#x27;semi&#x27;: &#x27;warn&#x27;,</span><br><span class="line">        &#x27;no-var&#x27;: &#x27;error&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>随后我们在 Webpack 配置文件中指定 ESLint 插件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const ESLintWebpackPlugin = require(&quot;eslint-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        new ESLintWebpackPlugin(options)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，<code>options</code> 是规范的具体选项，包括指定需要检查的根目录 <code>context</code>、需要检查的文件类型 <code>extension</code> 等等。详细内容可以参见 <a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/eslint-webpack-plugin/#root">官网</a>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const ESLintWebpackPlugin = require(&quot;eslint-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">	//检查哪些文件</span><br><span class="line">    context: path.resolve(__dirname, &#x27;src&#x27;),</span><br><span class="line">    extensions: &#x27;jsx&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        new ESLintWebpackPlugin(options)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们进行上述的配置后，运行命令 <code>npx webpack</code> 时，就会根据编辑的 ESLint 配置，对代码进行规范检查了。要注意因为配置了<code>extensions: &#39;jsx&#39;</code>，所以只会检查 src 下面的 jsx 文件</p>
<h3 id="不进行-ESLint-检查"><a href="#不进行-ESLint-检查" class="headerlink" title="不进行 ESLint 检查"></a>不进行 ESLint 检查</h3><p>如果有些文件不需要通过 ESLint 检查，那么我们只需要在根目录添加 <code>.eslintignore</code> 即可，<code>.eslintignore</code> 的语法格式与 <code>.gitignore</code> 一致：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- node_modules</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">	|--	src # 源码目录</span><br><span class="line">	|-- package.json</span><br><span class="line">	|-- webpack.config.js</span><br><span class="line">	|-- .eslintignore</span><br><span class="line">	|-- .eslintrc.js</span><br></pre></td></tr></table></figure>

<h2 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h2><p>Babel 是 JavaScript 编译器，主要用于将使用 ES6 语法编写的语法转换为向后兼容的 JavaScript 语法</p>
<h3 id="Babel-的配置文件"><a href="#Babel-的配置文件" class="headerlink" title="Babel 的配置文件"></a>Babel 的配置文件</h3><p>Babel 的配置文件有很多写法：</p>
<ol>
<li><p><code>babel.config.*</code> 类型：在项目根目录新建这种类型的文件，可以使用下面两种：</p>
<ul>
<li><p><code>babel.config.js</code></p>
</li>
<li><p><code>babel.config.json</code></p>
</li>
</ul>
</li>
<li><p><code>.babelrc.*</code> 类型：在项目根目录新建这种类型的文件，可以使用下面三种：</p>
<ul>
<li><p><code>.babelrc</code></p>
</li>
<li><p><code>.babelrc.js</code></p>
</li>
<li><p><code>.babelrc.json</code></p>
</li>
</ul>
</li>
<li><p>在 <code>package.json</code> 中配置 <code>babel</code></p>
</li>
</ol>
<p>当我们运行时，Babel 会查找并自动读取它们，因此上面的这些配置文件只需要存在一个。</p>
<h3 id="在-Webpack-中使用"><a href="#在-Webpack-中使用" class="headerlink" title="在 Webpack 中使用"></a>在 Webpack 中使用</h3><p>以编写 <code>babel.config.js</code> 配置文件为例。</p>
<p>首先，下载依赖 <code>babel</code>、<code>babel-loader</code>、<code>@babel/core</code>、<code>@babel/preset-env</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader @babel/core @babel/preset-env -D</span><br></pre></td></tr></table></figure>

<p>然后，在项目根目录创建 <code>bable.config.js</code> 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- node_modules</span><br><span class="line">	|-- public # 静态资源目录</span><br><span class="line">	|--	src # 源码目录</span><br><span class="line">	|-- package.json</span><br><span class="line">	|-- webpack.config.js</span><br><span class="line">	|-- babel.config.js</span><br><span class="line">	|-- .eslintrc.js</span><br></pre></td></tr></table></figure>

<p>Babel 配置文件的一个基本属性是预设 <code>presets</code>。<code>presets</code> 可以理解为 Babel 的插件，用于扩展 Babel 功能。常见的预设主要有下面三个：</p>
<ul>
<li>  <code>@babel/preset-env</code>：智能预设，允许使用最新的 JavaScript。</li>
<li>  <code>@babel/preset-react</code>：编译 React JSX 语法。</li>
<li>  <code>@babel/preset-typescript</code>：编译 TypeScript 语法。</li>
</ul>
<p>此处我们直接指定 <code>@babel/preset-env</code> 即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    presets: [&#x27;@babel/preset-env&#x27;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，在 Webpack 配置文件中使用 <code>babel-loader</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.js$/,</span><br><span class="line">                exclude: /node_modules/, // node_modules 目录中的文件不进行处理,</span><br><span class="line">                loader: &#x27;babel-loader&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="处理-HTML-资源"><a href="#处理-HTML-资源" class="headerlink" title="处理 HTML 资源"></a>处理 HTML 资源</h1><p>处理 HTML 资源的一个基本需求在于——如果我们不处理 HTML 文件，那么我们每次都需要手动引入打包后的 JS 以及其他资源；而如果连同 HTML 文件一起处理，那么将会自动载入打包后的其他资源，而不用我们再来手动引入。</p>
<p>我们使用 <code>html-webpack-plugin</code> 插件来处理 HTML 资源。</p>
<p>首先，下载依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>然后，我们在 Webpack 的配置文件中的 <code>plugins</code> 属性中使用插件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&#x27;path&#x27;)</span><br><span class="line">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, &#x27;public/index.html&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中，<code>template</code> 属性表示的是以某个 HTML 文件作为模板进行打包。打包后的 HTML 文件具有以下两个特点：</p>
<ol>
<li>内容与模板的 HTML 文件。</li>
<li>自动引入打包后的 JS 等资源。</li>
</ol>
<p>最后，我们需要删除原本 HTML 文件中手动导入的打包后的资源。</p>
<h1 id="搭建-dev-server"><a href="#搭建-dev-server" class="headerlink" title="搭建 dev-server"></a>搭建 dev-server</h1><p>每次修改完代码，我们都需要重新执行命令 <code>npx webpack</code>。使用 <code>dev-server</code> 可以帮助我们在运行状态下自动重新打包。</p>
<h2 id="下载依赖-1"><a href="#下载依赖-1" class="headerlink" title="下载依赖"></a>下载依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        host: &#x27;localhost&#x27;, // 启动服务器的域名,</span><br><span class="line">        port: &#x27;3000&#x27;, // 启动服务器的端口号,</span><br><span class="line">        open: true // 自动打开浏览器</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>之后我们不再需要使用 <code>npx webpack</code> 来单次运行服务器了，直接使用 <code>npx webpack serve</code> 即可。</p>
<p>要注意的是，我们使用 <code>dev-server</code> 开发者服务器，并不会实际将打包后的资源输出出来，而是直接在内存中编译打包。</p>
<h1 id="生产模式介绍"><a href="#生产模式介绍" class="headerlink" title="生产模式介绍"></a>生产模式介绍</h1><p>生产模式指的是当代码开发完成后，需要部署上线的环境。对于生产模式，我们主要考虑对打包后的代码进行优化，提升性能。</p>
<p>优化主要从两个角度出发：</p>
<ol>
<li>优化代码运行性能；</li>
<li>优化代码打包速度。</li>
</ol>
<h2 id="配置拆分"><a href="#配置拆分" class="headerlink" title="配置拆分"></a>配置拆分</h2><p>原本我们仅有 <code>webpack.config.js</code> 这一个 Webpack 配置文件，但是我们需要对开发环境与生产环境做出不同的 Webpack 配置。我们可以考虑将开发环境与生产环境的 Webpack 配置文件进行拆分，得到 <code>webpack.dev.js</code> 与 <code>webpack.prod.js</code> 这两个配置文件，然后我们重新定义脚本：当运行开发环境时，我们就调用 <code>config/webpack.dev.js</code> 配置文件；当运行生产环境时，我们就调用 <code>config/webpack.prod.js</code> 配置文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Code # 根目录（所有指令都必须在这个目录下运行）</span><br><span class="line">	|-- config</span><br><span class="line">		|-- webpack.dev.js</span><br><span class="line">		|-- webpack.prod.js</span><br><span class="line">	|-- node_modules</span><br><span class="line">	|-- public</span><br><span class="line">	|--	src</span><br><span class="line">	|-- package.json</span><br><span class="line">	|-- babel.config.js</span><br><span class="line">	|-- .eslintignore</span><br><span class="line">	|-- .eslintrc.js</span><br></pre></td></tr></table></figure>

<h2 id="详细配置"><a href="#详细配置" class="headerlink" title="详细配置"></a>详细配置</h2><ul>
<li>  <code>webpack.dev.js</code></li>
</ul>
<p>拆分配置文件后，生产模式下的配置主要有以下几点需要调整：</p>
<ol>
<li>由于配置文件被拆分放入了 <code>config</code> 目录，因此我们需要对开发环境的配置文件当中出现的目录层次进行更改；</li>
<li>由于开发环境不需要输出文件，因此可以将 <code>output</code> 置为空。</li>
</ol>
<ul>
<li>  <code>webpack.prod.js</code></li>
</ul>
<p>同样，生产环境的配置也有一些地方需要修改：</p>
<ol>
<li>调整目录层次；</li>
<li>不再需要开发服务器 <code>dev-server</code>；</li>
<li>将 <code>mode</code> 属性更改为 <code>production</code>。</li>
</ol>
<h1 id="处理-CSS-资源-1"><a href="#处理-CSS-资源-1" class="headerlink" title="处理 CSS 资源"></a>处理 CSS 资源</h1><p>在前面的小节中，我们处理了样式资源，但是这只是将样式资源能够成功进行打包。而在生产环境中，我们则需要额外关注项目性能等等方面，因此需要在生产环境下，单独对 CSS 资源进行处理。</p>
<p>对 CSS 资源的处理主要包括三点：</p>
<ol>
<li>将 CSS 资源提取为单独文件；</li>
</ol>
<p>在前面的小节中，我们通过 <code>style-loader</code> 这个 <code>loader</code> 将处理好的样式资源直接导入 JS 输出文件中。当 JS 文件加载时，会创建 <code>&lt;style&gt;</code> 标签生成样式。</p>
<p>但是对于网站而言，这样的处理方式容易出现闪屏现象，用户体验下降。如果想要优化这一点，可以将 CSS 资源提取为单独的文件，最后通过 <code>&lt;link&gt;</code> 标签加载。</p>
<ol start="2">
<li>对 CSS 资源进行兼容性处理；</li>
</ol>
<p>因为许多浏览器版本与兼容的原因，很多时候我们需要将 CSS 资源进行兼容性处理。</p>
<ol start="3">
<li>压缩 CSS 资源。</li>
</ol>
<p>生产环境需要将最后打包生成的文件投入真正的使用中，如果文件太大，容易造成网络堵塞等等情况。压缩 CSS 资源则可以减小打包得到 CSS 资源体积，从而提升性能。</p>
<h2 id="将-CSS-资源提取为单独文件"><a href="#将-CSS-资源提取为单独文件" class="headerlink" title="将 CSS 资源提取为单独文件"></a>将 CSS 资源提取为单独文件</h2><p>原本我们通过 <code>style-loader</code> 对 CSS 资源进行处理，现在我们需要另外一个 <code>loader</code>。但是这个 <code>loader</code> 与 <code>style-loader</code> 不同，并不是直接下载，而是需要下载 <code>mini-css-extract-plugin</code> 这个插件，然后从这个插件中导入 <code>loader</code>。当然，我们也需要在 <code>plugins</code> 中对这个插件进行配置。</p>
<p>首先，我们下载插件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure>

<p>然后，我们修改配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">const MiniCssExtractPlugin = require(&#x27;mini-css-extract-plugin&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.css$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    &#x27;css-loader&#x27;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.less$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    &#x27;css-loader&#x27;,</span><br><span class="line">                    &#x27;less-loader&#x27;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.s[ac]ss$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    &#x27;css-loader&#x27;,</span><br><span class="line">                    &#x27;sass-loader&#x27;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &#x27;css/index.css&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: &#x27;production&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于我们将 CSS 资源提取为了单独的文件，因此我们同样可以传入选项参数指定输出路径。</p>
<h2 id="兼容性处理"><a href="#兼容性处理" class="headerlink" title="兼容性处理"></a>兼容性处理</h2><p>我们使用 <code>postcss-loader</code> 这个依赖处理 CSS 兼容性问题。但是除此之外，我们需要使用 <code>loader</code> 中的一个插件 <code>postcss-preset-env</code> 来协助处理。同时，<code>postcss-loader</code> 依赖 <code>postcss</code>，因此我们一共需要下载三个依赖才能处理 CSS 兼容性问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install postcss-loader postcss postcss-preset-env -D</span><br></pre></td></tr></table></figure>

<p>接下来，修改配置文件：</p>
<blockquote>
<p>值得注意的是，当我们将其他资源转化为 CSS 资源后，我们才对 CSS 资源进行兼容性处理，而不是直接对其他资源如 Less 资源进行兼容性处理。因此，<code>use</code> 属性中各个元素的排列顺序很重要。即，我们在 需要写在 css-loader 的后面（因为是逆序，所以实际上顺序是前面）, 但是需要写在 less-loader 的前面</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">const MiniCssExtractPlugin = require(&#x27;mini-css-extract-plugin&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.css$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    &#x27;css-loader&#x27;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: &#x27;postcss-loader&#x27;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            postcssOptions: &#123;</span><br><span class="line">                                plugins: [</span><br><span class="line">                                    &#x27;postcss-preset-env&#x27;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.less$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    &#x27;css-loader&#x27;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: &#x27;postcss-loader&#x27;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            postcssOptions: &#123;</span><br><span class="line">                                plugins: [</span><br><span class="line">                                    &#x27;postcss-preset-env&#x27;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#x27;less-loader&#x27;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.s[ac]ss$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    &#x27;css-loader&#x27;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: &#x27;postcss-loader&#x27;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            postcssOptions: &#123;</span><br><span class="line">                                plugins: [</span><br><span class="line">                                    &#x27;postcss-preset-env&#x27;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#x27;sass-loader&#x27;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>postcss-loader</code> 可以处理大部分的兼容性问题，但是我们也可以在 <code>package.json</code> 中指定配置使用的浏览器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;browserslist&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;last 2 version&quot;</span>, <span class="comment">//代表所有浏览器</span></span><br><span class="line">        <span class="string">&quot;&gt; 1%&quot;</span>,  覆盖 <span class="number">99</span>% 的浏览器</span><br><span class="line">        <span class="string">&quot;not dead&quot;</span>  有些浏览器版本已经死了就不要了</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">上面的是取交集</span><br></pre></td></tr></table></figure>

<p>详细的 <code>browserslist</code> 说明可以参见 <a target="_blank" rel="noopener" href="https://github.com/browserslist/browserslist">官方文档</a>。</p>
<h2 id="封装-loader"><a href="#封装-loader" class="headerlink" title="封装 loader"></a>封装 loader</h2><p>此时已经可以发现，处理 CSS 资源的 <code>rules</code> 出现了大量的重复内容。为了让代码可读性更强、更容易复用，我们可以将公共的这部分封装为一个方法，将差异性的内容作为参数传递进去：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">const MiniCssExtractPlugin = require(&#x27;mini-css-extract-plugin&#x27;)</span><br><span class="line"></span><br><span class="line">const getStyleLoader = (para) =&gt; &#123;</span><br><span class="line">    return [</span><br><span class="line">        MiniCssExtractPlugin.loader,</span><br><span class="line">        &#x27;css-loader&#x27;,</span><br><span class="line">        &#123;</span><br><span class="line">            loader: &#x27;postcss-loader&#x27;,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        &#x27;postcss-preset-env&#x27;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        para</span><br><span class="line">    ].filter(Boolean) //传入 boolean 会把 undefined 的值过滤掉</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.css$/,</span><br><span class="line">                use: getStyleLoader()</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.less$/,</span><br><span class="line">                use: getStyleLoader(&#x27;less-loader&#x27;)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.s[ac]ss$/,</span><br><span class="line">                use: getStyleLoader(&#x27;sass-loader&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CSS-压缩"><a href="#CSS-压缩" class="headerlink" title="CSS 压缩"></a>CSS 压缩</h2><p>我们使用 <code>css-minimizer-webpack-plugin</code> 这个插件进行 CSS 压缩。</p>
<p>首先下载依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install css-minimizer-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>然后我们进行插件的配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const CssMinimizerWebpackPlugin = require(&#x27;css-minimizer-webpack-plugin&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        new CssMinimizerWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>显然，JS 与 HTML 资源在生产模式下也需要压缩，只是在生产模式下这两种类型的文件会自动压缩，因此不需要进行额外的配置。</p>
</blockquote>
<h1 id="生产模式总结"><a href="#生产模式总结" class="headerlink" title="生产模式总结"></a>生产模式总结</h1><p>此时，基本的生产模式配置已经实现，参考如下：</p>
<ul>
<li>  <code>config.webpack.prod.js</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">	<span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>), <span class="comment">//检查哪里的代码</span></span><br><span class="line">	<span class="attr">extensions</span>: <span class="string">&#x27;js&#x27;</span>, <span class="comment">//检查什么类型的文件</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoader</span> = (<span class="params">para</span>) =&gt; &#123;</span><br><span class="line">	<span class="keyword">return</span> [</span><br><span class="line">		<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">		<span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">			<span class="attr">options</span>: &#123;</span><br><span class="line">				<span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">					<span class="attr">plugins</span>: [<span class="string">&#x27;postcss-preset-env&#x27;</span>],</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		para,</span><br><span class="line">	].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>, <span class="comment">//从哪开始</span></span><br><span class="line">	<span class="attr">output</span>: &#123;</span><br><span class="line">		<span class="comment">//输出到哪</span></span><br><span class="line">		<span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dist&#x27;</span>), <span class="comment">//输出路径</span></span><br><span class="line">		<span class="attr">filename</span>: <span class="string">&#x27;js/index.js&#x27;</span>, <span class="comment">//指定输出文件相对于 `path` 的目录</span></span><br><span class="line">		<span class="attr">clean</span>: <span class="literal">true</span>, <span class="comment">//是否清除上次打包的文件</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">				<span class="attr">use</span>: <span class="title function_">getStyleLoader</span>(),</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">				<span class="attr">use</span>: <span class="title function_">getStyleLoader</span>(<span class="string">&#x27;less-loader&#x27;</span>),</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">				<span class="attr">use</span>: <span class="title function_">getStyleLoader</span>(<span class="string">&#x27;sass-loader&#x27;</span>),</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">				<span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">				<span class="attr">parser</span>: &#123;</span><br><span class="line">					<span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">						<span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>,</span><br><span class="line">					&#125;,</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">generator</span>: &#123;</span><br><span class="line">					<span class="attr">filename</span>: <span class="string">&#x27;imgs/[hash:8][ext]&#x27;</span>,</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">				<span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">				<span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">plugins</span>: [</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(options), <span class="comment">//配置 ESLint</span></span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">			<span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../public/index.html&#x27;</span>),</span><br><span class="line">		&#125;), <span class="comment">//配置 html, 让他自动载入打包后的其他资源</span></span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">			<span class="attr">filename</span>: <span class="string">&#x27;css/index.css&#x27;</span>,</span><br><span class="line">		&#125;), <span class="comment">//将css单独提出出来</span></span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">CssMinimizerWebpackPlugin</span>(), <span class="comment">//压缩css</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  <code>package.json</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...,</span><br><span class="line">    <span class="string">&quot;browserslist&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;last 2 version&quot;</span>,  <span class="comment">//全部的浏览器</span></span><br><span class="line">        <span class="string">&quot;&gt; 1%&quot;</span>,   <span class="comment">//覆盖 99%</span></span><br><span class="line">        <span class="string">&quot;not dead&quot;</span>  <span class="comment">//已经过时的浏览器就不要了</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="提升开发体验"><a href="#提升开发体验" class="headerlink" title="提升开发体验"></a>提升开发体验</h1><h2 id="Source-Map"><a href="#Source-Map" class="headerlink" title="Source Map"></a>Source Map</h2><h3 id="SourceMap"><a href="#SourceMap" class="headerlink" title="SourceMap"></a>SourceMap</h3><p>SourceMap（源代码映射）是一个用来生成源代码与构建后代码一一映射的文件的方案。</p>
<p>它会生成 map 文件，里面包含源代码和构建后代码每一行、每一列的映射关系。当构建后代码出错了，会通过这个 map 文件，从构建后代码出错位置找到映射后源代码出错位置，从而让浏览器提示源代码文件出错位置，帮助我们更快的找到错误根源。</p>
<p>SourceMap 的值有许多，但实际开发时我们只需要关注两种情况：</p>
<ul>
<li>开发模式：<code>cheap-module-source-map</code><ul>
<li>  优点：打包编译速度快，只包含行映射</li>
<li>  缺点：没有列映射</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    devtool: &#x27;cheap-module-source-map&#x27;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>生产模式：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source-map</span><br></pre></td></tr></table></figure>

<ul>
<li>  优点：包含行/列映射</li>
<li>  缺点：打包编译速度更慢</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    mode: &#x27;production&#x27;,</span><br><span class="line">    devtool: &#x27;source-map&#x27;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="提升打包构建速度"><a href="#提升打包构建速度" class="headerlink" title="提升打包构建速度"></a>提升打包构建速度</h1><h2 id="Hot-Module-Replacement"><a href="#Hot-Module-Replacement" class="headerlink" title="Hot Module Replacement"></a>Hot Module Replacement</h2><p>开发过程中，可能只修改了一部分代码，但是 Webpack 默认会将所有模块全部重新打包编译，导致效率降低；如果能实现当修改某个模块代码时，就只有这个模块代码需要重新打包编译，其他模块不变，这样效率就会变高。</p>
<p>Hot Module Replacement（HMR/热模块替换）可以实现在程序运行中，替换、添加或删除模块，而无需重新加载整个页面。默认就是开启的</p>
<ul>
<li>  <code>webpack.dev.js</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        host: &#x27;localhost&#x27;, // 启动服务器的域名,</span><br><span class="line">        port: &#x27;3000&#x27;, // 启动服务器的端口号,</span><br><span class="line">        open: true, // 自动打开浏览器</span><br><span class="line">        hot: true // 开启 HMR，默认值就为 true</span><br><span class="line">    &#125;,</span><br><span class="line">    // 模式</span><br><span class="line">    mode: &#x27;development&#x27;,</span><br><span class="line">    devtool: &#x27;cheap-module-source-map&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，CSS 经过 <code>style-loader</code> 处理，已经具备 HMR 功能。但是此时 JS 资源并不具备 HMR 功能。</p>
<p>如果想要在 JS 中实现 HMR 功能，需要手动进行判断是否支持：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import sum from &#x27;./js/sum&#x27;</span><br><span class="line">import count from &#x27;./js/count&#x27;</span><br><span class="line">import &#x27;./css/index.css&#x27;</span><br><span class="line">import &#x27;./less/index.less&#x27;</span><br><span class="line"></span><br><span class="line">console.log(sum(1, 2, 3, 4))</span><br><span class="line">console.log(count(3, 1))</span><br><span class="line"></span><br><span class="line">if (module.hot) &#123; // 判断是否支持 HMR 功能</span><br><span class="line">    module.hot.accept(&#x27;./js/sum&#x27;)</span><br><span class="line">    module.hot.accept(&#x27;./js/count&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是在实际开发中，像上面这样手动指定会非常麻烦，因此实际开发我们会使用其他 loader 来解决，如 <a target="_blank" rel="noopener" href="https://github.com/gaearon/react-hot-loader">react-hot-loader</a>。</p>
<h2 id="OneOf"><a href="#OneOf" class="headerlink" title="OneOf"></a>OneOf</h2><p><code>OneOf</code> 是规则数组，用于表示当规则匹配时，只使用第一个匹配规则：</p>
<ul>
<li>  <code>webpack.dev.js</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                // 每个文件只能被其中一个 loader 处理</span><br><span class="line">                oneOf: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.css$/,</span><br><span class="line">                        use: [</span><br><span class="line">                            // 从后往前执行，先执行 css-loader，再执行 style-loader</span><br><span class="line">                            &#x27;style-loader&#x27;,</span><br><span class="line">                            &#x27;css-loader&#x27;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.less$/,</span><br><span class="line">                        use: [</span><br><span class="line">                            &#x27;style-loader&#x27;,</span><br><span class="line">                            &#x27;css-loader&#x27;,</span><br><span class="line">                            &#x27;less-loader&#x27;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.s[ac]ss$/,</span><br><span class="line">                        use: [</span><br><span class="line">                            &#x27;style-loader&#x27;,</span><br><span class="line">                            &#x27;css-loader&#x27;,</span><br><span class="line">                            &#x27;sass-loader&#x27;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.(png|jpe?g|gif|webp)$/,</span><br><span class="line">                        type: &quot;asset&quot;,</span><br><span class="line">                        generator: &#123;</span><br><span class="line">                            filename: &#x27;images/[hash][ext][query]&#x27;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        parser: &#123;</span><br><span class="line">                            dataUrlCondition: &#123;</span><br><span class="line">                                maxSize: 16 * 1024 // 16 kb</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.js$/,</span><br><span class="line">                        exclude: /node_modules/, // node_modules 目录中的文件不进行处理,</span><br><span class="line">                        loader: &#x27;babel-loader&#x27;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: &#x27;development&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>  <code>webpack.prod.js</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                oneOf: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.css$/,</span><br><span class="line">                        use: getStyleLoader()</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.less$/,</span><br><span class="line">                        use: getStyleLoader(&#x27;less-loader&#x27;)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.s[ac]ss$/,</span><br><span class="line">                        use: getStyleLoader(&#x27;sass-loader&#x27;)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.(png|jpe?g|gif|webp)$/,</span><br><span class="line">                        type: &quot;asset&quot;,</span><br><span class="line">                        generator: &#123;</span><br><span class="line">                            filename: &#x27;images/[hash][ext][query]&#x27;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        parser: &#123;</span><br><span class="line">                            dataUrlCondition: &#123;</span><br><span class="line">                                maxSize: 16 * 1024 // 16 kb</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.js$/,</span><br><span class="line">                        exclude: /node_modules/, // node_modules 目录中的文件不进行处理,</span><br><span class="line">                        loader: &#x27;babel-loader&#x27;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    // 模式</span><br><span class="line">    mode: &#x27;production&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="InClude-Exclude"><a href="#InClude-Exclude" class="headerlink" title="InClude / Exclude"></a>InClude / Exclude</h2><ul>
<li>  <code>include</code></li>
</ul>
<p><code>include</code> 用于指定该规则包含哪些目录的文件。</p>
<ul>
<li>  <code>exclude</code></li>
</ul>
<p><code>exclude</code> 用于排除哪些目录。</p>
<p>要注意的是，对于一个匹配规则，<code>include</code> 关键字与 <code>exclude</code> 关键字只能存在一个。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                // 每个文件只能被其中一个 loader 处理</span><br><span class="line">                oneOf: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: /\.js$/,</span><br><span class="line">                        exclude: /node_modules/,</span><br><span class="line">                        // node_modules 目录中的文件不进行处理, 其他文件都处理</span><br><span class="line">                        // include: path.resolve(__dirname, &#x27;../src&#x27;),</span><br><span class="line">                        // 只处理 src 目录下的文件，其他文件不处理</span><br><span class="line">                        loader: &#x27;babel-loader&#x27;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h2><p>每次打包时 js 文件都要经过 Eslint 检查 和 Babel 编译，速度比较慢。</p>
<p>我们可以缓存之前的 Eslint 检查 和 Babel 编译结果，这样第二次打包时速度就会更快了。</p>
<p>对 Eslint 检查 和 Babel 编译结果进行缓存。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">	<span class="attr">output</span>: &#123;</span><br><span class="line">		<span class="attr">path</span>: <span class="literal">undefined</span>, <span class="comment">// 开发模式没有输出，不需要指定输出目录</span></span><br><span class="line">		<span class="attr">filename</span>: <span class="string">&#x27;static/js/main.js&#x27;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">		<span class="comment">// clean: true, // 开发模式没有输出，不需要清空输出结果</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">oneOf</span>: [</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">						<span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">						<span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>],</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">						<span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>],</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">						<span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;sass-loader&#x27;</span>],</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">						<span class="attr">use</span>: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;stylus-loader&#x27;</span>],</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">						<span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">						<span class="attr">parser</span>: &#123;</span><br><span class="line">							<span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">								<span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">							&#125;,</span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">generator</span>: &#123;</span><br><span class="line">							<span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">							<span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">							<span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">							<span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">							<span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">							<span class="attr">filename</span>: <span class="string">&#x27;static/imgs/[hash:8][ext][query]&#x27;</span>,</span><br><span class="line">						&#125;,</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">						<span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">						<span class="attr">generator</span>: &#123;</span><br><span class="line">							<span class="attr">filename</span>: <span class="string">&#x27;static/media/[hash:8][ext][query]&#x27;</span>,</span><br><span class="line">						&#125;,</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">						<span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">						<span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">						<span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">						<span class="attr">options</span>: &#123;</span><br><span class="line">							<span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">							<span class="attr">cacheCompression</span>: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">						&#125;,</span><br><span class="line">					&#125;,</span><br><span class="line">				],</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">plugins</span>: [</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">			<span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">			<span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>),</span><br><span class="line">			<span class="attr">exclude</span>: <span class="string">&#x27;node_modules&#x27;</span>, <span class="comment">// 默认值</span></span><br><span class="line">			<span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">			<span class="comment">// 缓存目录</span></span><br><span class="line">			<span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">				__dirname,</span><br><span class="line">				<span class="string">&#x27;../node_modules/.cache/.eslintcache&#x27;</span></span><br><span class="line">			),</span><br><span class="line">		&#125;),</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">			<span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">			<span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">			<span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../public/index.html&#x27;</span>),</span><br><span class="line">		&#125;),</span><br><span class="line">	],</span><br><span class="line">	<span class="comment">// 开发服务器</span></span><br><span class="line">	<span class="attr">devServer</span>: &#123;</span><br><span class="line">		<span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">		<span class="attr">port</span>: <span class="string">&#x27;3000&#x27;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">		<span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">		<span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// 开启HMR功能</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">	<span class="attr">devtool</span>: <span class="string">&#x27;cheap-module-source-map&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Thead"><a href="#Thead" class="headerlink" title="Thead"></a>Thead</h2><p>当项目越来越庞大时，打包速度越来越慢，甚至于需要一个下午才能打包出来代码。这个速度是比较慢的。</p>
<p>我们想要继续提升打包速度，其实就是要提升 js 的打包速度，因为其他文件都比较少。</p>
<p>而对 js 文件处理主要就是 eslint 、babel、Terser 三个工具，所以我们要提升它们的运行速度。</p>
<p>我们可以开启多进程同时处理 js 文件，这样速度就比之前的单进程打包更快了。</p>
<p>多进程打包：开启电脑的多个进程同时干一件事，速度更快。</p>
<p><strong>需要注意：请仅在特别耗时的操作中使用，因为每个进程启动就有大约为 600ms 左右开销。</strong></p>
<p>怎么用</p>
<p>我们启动进程的数量就是我们 CPU 的核数。</p>
<ol>
<li>如何获取 CPU 的核数，因为每个电脑都不一样。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nodejs核心模块，直接使用</span></span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)</span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>下载包</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i thread-loader -D</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// cpu核数</span></span><br><span class="line"><span class="keyword">const</span> threads = os.<span class="title function_">cpus</span>().<span class="property">length</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取处理样式的Loaders</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStyleLoaders</span> = (<span class="params">preProcessor</span>) =&gt; &#123;</span><br><span class="line">	<span class="keyword">return</span> [</span><br><span class="line">		<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">		<span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">			<span class="attr">options</span>: &#123;</span><br><span class="line">				<span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">					<span class="attr">plugins</span>: [</span><br><span class="line">						<span class="string">&#x27;postcss-preset-env&#x27;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">					],</span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">		preProcessor,</span><br><span class="line">	].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">entry</span>: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">	<span class="attr">output</span>: &#123;</span><br><span class="line">		<span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dist&#x27;</span>), <span class="comment">// 生产模式需要输出</span></span><br><span class="line">		<span class="attr">filename</span>: <span class="string">&#x27;static/js/main.js&#x27;</span>, <span class="comment">// 将 js 文件输出到 static/js 目录中</span></span><br><span class="line">		<span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">module</span>: &#123;</span><br><span class="line">		<span class="attr">rules</span>: [</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="attr">oneOf</span>: [</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">						<span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">						<span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(),</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">						<span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&#x27;less-loader&#x27;</span>),</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">						<span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&#x27;sass-loader&#x27;</span>),</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">						<span class="attr">use</span>: <span class="title function_">getStyleLoaders</span>(<span class="string">&#x27;stylus-loader&#x27;</span>),</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">						<span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>,</span><br><span class="line">						<span class="attr">parser</span>: &#123;</span><br><span class="line">							<span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">								<span class="attr">maxSize</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">							&#125;,</span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">generator</span>: &#123;</span><br><span class="line">							<span class="comment">// 将图片文件输出到 static/imgs 目录中</span></span><br><span class="line">							<span class="comment">// 将图片文件命名 [hash:8][ext][query]</span></span><br><span class="line">							<span class="comment">// [hash:8]: hash值取8位</span></span><br><span class="line">							<span class="comment">// [ext]: 使用之前的文件扩展名</span></span><br><span class="line">							<span class="comment">// [query]: 添加之前的query参数</span></span><br><span class="line">							<span class="attr">filename</span>: <span class="string">&#x27;static/imgs/[hash:8][ext][query]&#x27;</span>,</span><br><span class="line">						&#125;,</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">						<span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">						<span class="attr">generator</span>: &#123;</span><br><span class="line">							<span class="attr">filename</span>: <span class="string">&#x27;static/media/[hash:8][ext][query]&#x27;</span>,</span><br><span class="line">						&#125;,</span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">						<span class="comment">// exclude: /node_modules/, // 排除node_modules代码不编译</span></span><br><span class="line">						<span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>), <span class="comment">// 也可以用包含</span></span><br><span class="line">						<span class="attr">use</span>: [</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="attr">loader</span>: <span class="string">&#x27;thread-loader&#x27;</span>, <span class="comment">// 开启多进程</span></span><br><span class="line">								<span class="attr">options</span>: &#123;</span><br><span class="line">									<span class="attr">workers</span>: threads, <span class="comment">// 数量</span></span><br><span class="line">								&#125;,</span><br><span class="line">							&#125;,</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">								<span class="attr">options</span>: &#123;</span><br><span class="line">									<span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">								&#125;,</span><br><span class="line">							&#125;,</span><br><span class="line">						],</span><br><span class="line">					&#125;,</span><br><span class="line">				],</span><br><span class="line">			&#125;,</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">plugins</span>: [</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">ESLintWebpackPlugin</span>(&#123;</span><br><span class="line">			<span class="comment">// 指定检查文件的根目录</span></span><br><span class="line">			<span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>),</span><br><span class="line">			<span class="attr">exclude</span>: <span class="string">&#x27;node_modules&#x27;</span>, <span class="comment">// 默认值</span></span><br><span class="line">			<span class="attr">cache</span>: <span class="literal">true</span>, <span class="comment">// 开启缓存</span></span><br><span class="line">			<span class="comment">// 缓存目录</span></span><br><span class="line">			<span class="attr">cacheLocation</span>: path.<span class="title function_">resolve</span>(</span><br><span class="line">				__dirname,</span><br><span class="line">				<span class="string">&#x27;../node_modules/.cache/.eslintcache&#x27;</span></span><br><span class="line">			),</span><br><span class="line">			threads, <span class="comment">// 开启多进程</span></span><br><span class="line">		&#125;),</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">			<span class="comment">// 以 public/index.html 为模板创建文件</span></span><br><span class="line">			<span class="comment">// 新的html文件有两个特点：1. 内容和源文件一致 2. 自动引入打包生成的js等资源</span></span><br><span class="line">			<span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../public/index.html&#x27;</span>),</span><br><span class="line">		&#125;),</span><br><span class="line">		<span class="comment">// 提取css成单独文件</span></span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">			<span class="comment">// 定义输出文件名和目录</span></span><br><span class="line">			<span class="attr">filename</span>: <span class="string">&#x27;static/css/main.css&#x27;</span>,</span><br><span class="line">		&#125;),</span><br><span class="line">		<span class="comment">// css压缩</span></span><br><span class="line">		<span class="comment">// new CssMinimizerPlugin(),</span></span><br><span class="line">	],</span><br><span class="line">	<span class="attr">optimization</span>: &#123;</span><br><span class="line">		<span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">minimizer</span>: [</span><br><span class="line">			<span class="comment">// css压缩也可以写到optimization.minimizer里面，效果一样的</span></span><br><span class="line">			<span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">			<span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">			<span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;</span><br><span class="line">				<span class="attr">parallel</span>: threads, <span class="comment">// 开启多进程</span></span><br><span class="line">			&#125;),</span><br><span class="line">		],</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// devServer: &#123;</span></span><br><span class="line">	<span class="comment">//   host: &quot;localhost&quot;, // 启动服务器域名</span></span><br><span class="line">	<span class="comment">//   port: &quot;3000&quot;, // 启动服务器端口号</span></span><br><span class="line">	<span class="comment">//   open: true, // 是否自动打开浏览器</span></span><br><span class="line">	<span class="comment">// &#125;,</span></span><br><span class="line">	<span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">	<span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="减少代码体积"><a href="#减少代码体积" class="headerlink" title="减少代码体积"></a>减少代码体积</h1><h2 id="Tree-Shaking"><a href="#Tree-Shaking" class="headerlink" title="Tree Shaking"></a>Tree Shaking</h2><p>开发时我们定义了一些工具函数库，或者引用第三方工具函数库或组件库。</p>
<p>如果没有特殊处理的话我们打包时会引入整个库，但是实际上可能我们可能只用上极小部分的功能。</p>
<p>这样将整个库都打包进来，体积就太大了。</p>
<p><code>Tree Shaking</code> 是一个术语，通常用于描述移除 JavaScript 中的没有使用上的代码。</p>
<p><strong>注意：它依赖 <code>ES Module</code>。</strong></p>
<p>Webpack 已经默认开启了这个功能，无需其他配置。</p>
<h2 id="Babel-1"><a href="#Babel-1" class="headerlink" title="Babel"></a>Babel</h2><p>Babel 为编译的每个文件都插入了辅助代码，使代码体积过大！</p>
<p>Babel 对一些公共方法使用了非常小的辅助代码，比如 <code>_extend</code>。默认情况下会被添加到每一个需要它的文件中。</p>
<p>你可以将这些辅助代码作为一个独立模块，来避免重复引入。</p>
<p><code>@babel/plugin-transform-runtime</code>: 禁用了 Babel 自动对每个文件的 runtime 注入，而是引入 <code>@babel/plugin-transform-runtime</code> 并且使所有辅助代码从这里引用。</p>
<p>下载包</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/plugin-transform-runtime -D</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">                loader: &quot;babel-loader&quot;,</span><br><span class="line">                options: &#123;</span><br><span class="line">                  cacheDirectory: true, // 开启babel编译缓存</span><br><span class="line">                  cacheCompression: false, // 缓存文件不要压缩</span><br><span class="line">                  plugins: [&quot;@babel/plugin-transform-runtime&quot;], // 减少代码体积</span><br><span class="line">                &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="Image-Minimizer"><a href="#Image-Minimizer" class="headerlink" title="Image Minimizer"></a>Image Minimizer</h2><p>开发如果项目中引用了较多图片，那么图片体积会比较大，将来请求速度比较慢。</p>
<p>我们可以对图片进行压缩，减少图片体积。</p>
<p><strong>注意：如果项目中图片都是在线链接，那么就不需要了。本地项目静态图片才需要进行压缩。</strong></p>
<p><code>image-minimizer-webpack-plugin</code>: 用来压缩图片的插件</p>
<ol>
<li>下载包</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i image-minimizer-webpack-plugin imagemin -D</span><br></pre></td></tr></table></figure>

<p>还有剩下需要下载，有两种模式：</p>
<ul>
<li>  无损压缩</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo -D</span><br></pre></td></tr></table></figure>

<ul>
<li>  有损压缩</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imagemin-gifsicle imagemin-mozjpeg imagemin-pngquant imagemin-svgo -D</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">const ImageMinimizerPlugin = require(&quot;image-minimizer-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      // css压缩也可以写到optimization.minimizer里面，效果一样的</span><br><span class="line">      new CssMinimizerPlugin(),</span><br><span class="line">      // 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span><br><span class="line">      new TerserPlugin(&#123;</span><br><span class="line">        parallel: threads, // 开启多进程</span><br><span class="line">      &#125;),</span><br><span class="line">      // 压缩图片</span><br><span class="line">      new ImageMinimizerPlugin(&#123;</span><br><span class="line">        minimizer: &#123;</span><br><span class="line">          implementation: ImageMinimizerPlugin.imageminGenerate,</span><br><span class="line">          options: &#123;</span><br><span class="line">            plugins: [</span><br><span class="line">              [&quot;gifsicle&quot;, &#123; interlaced: true &#125;],</span><br><span class="line">              [&quot;jpegtran&quot;, &#123; progressive: true &#125;],</span><br><span class="line">              [&quot;optipng&quot;, &#123; optimizationLevel: 5 &#125;],</span><br><span class="line">              [</span><br><span class="line">                &quot;svgo&quot;,</span><br><span class="line">                &#123;</span><br><span class="line">                  plugins: [</span><br><span class="line">                    &quot;preset-default&quot;,</span><br><span class="line">                    &quot;prefixIds&quot;,</span><br><span class="line">                    &#123;</span><br><span class="line">                      name: &quot;sortAttrs&quot;,</span><br><span class="line">                      params: &#123;</span><br><span class="line">                        xmlnsOrder: &quot;alphabetical&quot;,</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br></pre></td></tr></table></figure>

<p>打包时会出现报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error: Error with &#x27;src\images\1.jpeg&#x27;: &#x27;&quot;C:\Users\86176\Desktop\webpack\webpack_code\node_modules\jpegtran-bin\vendor\jpegtran.exe&quot;&#x27;</span><br><span class="line">Error with &#x27;src\images\3.gif&#x27;: spawn C:\Users\86176\Desktop\webpack\webpack_code\node_modules\optipng-bin\vendor\optipng.exe ENOENT</span><br></pre></td></tr></table></figure>

<p>我们需要安装两个文件到 node_modules 中才能解决, 文件可以从课件中找到：</p>
<ul>
<li>  jpegtran.exe</li>
</ul>
<p>需要复制到 <code>node_modules\jpegtran-bin\vendor</code> 下面</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://jpegclub.org/jpegtran/">jpegtran 官网地址 open in new window</a></p>
</blockquote>
<ul>
<li>  optipng.exe</li>
</ul>
<p>需要复制到 <code>node_modules\optipng-bin\vendor</code> 下面</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://optipng.sourceforge.net/">OptiPNG 官网地址</a></p>
</blockquote>
<h1 id="优化代码运行性能"><a href="#优化代码运行性能" class="headerlink" title="优化代码运行性能"></a>优化代码运行性能</h1><h2 id="Code-Split"><a href="#Code-Split" class="headerlink" title="Code Split"></a>Code Split</h2><p>打包代码时会将所有 js 文件打包到一个文件中，体积太大了。我们如果只要渲染首页，就应该只加载首页的 js 文件，其他文件不应该加载。</p>
<p>所以我们需要将打包生成的文件进行代码分割，生成多个 js 文件，渲染哪个页面就只加载某个 js 文件，这样加载的资源就少，速度就更快。</p>
<p>代码分割（Code Split）主要做了两件事：</p>
<ol>
<li>分割文件：将打包生成的文件进行分割，生成多个 js 文件。</li>
<li>按需加载：需要哪个文件就加载哪个文件。</li>
</ol>
<p>代码分割实现方式有不同的方式，为了更加方便体现它们之间的差异，我们会分别创建新的文件来演示</p>
<ol>
<li>文件目录</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── public</span><br><span class="line">├── src</span><br><span class="line">|   ├── app.js</span><br><span class="line">|   └── main.js</span><br><span class="line">├── package.json</span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>下载包</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli html-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>新建文件</li>
</ol>
<p>内容无关紧要，主要观察打包输出的结果</p>
<ul>
<li>  app.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>  main.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello main&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// webpack.config.js</span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // 单入口</span><br><span class="line">  // entry: &#x27;./src/main.js&#x27;,</span><br><span class="line">  // 多入口</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &quot;./src/main.js&quot;,</span><br><span class="line">    app: &quot;./src/app.js&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, &quot;./dist&quot;),</span><br><span class="line">    // [name]是webpack命名规则，使用chunk的name作为输出的文件名。</span><br><span class="line">    // 什么是chunk？打包的资源就是chunk，输出出去叫bundle。</span><br><span class="line">    // chunk的name是啥呢？ 比如： entry中xxx: &quot;./src/xxx.js&quot;, name就是xxx。注意是前面的xxx，和文件名无关。</span><br><span class="line">    // 为什么需要这样命名呢？如果还是之前写法main.js，那么打包生成两个js文件都会叫做main.js会发生覆盖。(实际上会直接报错的)</span><br><span class="line">    filename: &quot;js/[name].js&quot;,</span><br><span class="line">    clear: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: &quot;./public/index.html&quot;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  mode: &quot;production&quot;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>运行指令</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<p>此时在 dist 目录我们能看到输出了两个 js 文件。</p>
<p>总结：配置了几个入口，至少输出几个 js 文件。</p>
<ol start="2">
<li>提取重复代码</li>
</ol>
<p>如果多入口文件中都引用了同一份代码，我们不希望这份代码被打包到两个文件中，导致代码重复，体积更大。</p>
<p>我们需要提取多入口的重复代码，只打包生成一个 js 文件，其他文件引用它就好。</p>
<ol>
<li>修改文件</li>
</ol>
<ul>
<li>  app.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello app&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>  main.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">&#x27;./math&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello main&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>  math.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">sum</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">	<span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">p, c</span>) =&gt;</span> p + c, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改配置文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">// webpack.config.js</span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  // 单入口</span><br><span class="line">  // entry: &#x27;./src/main.js&#x27;,</span><br><span class="line">  // 多入口</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: &quot;./src/main.js&quot;,</span><br><span class="line">    app: &quot;./src/app.js&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, &quot;./dist&quot;),</span><br><span class="line">    // [name]是webpack命名规则，使用chunk的name作为输出的文件名。</span><br><span class="line">    // 什么是chunk？打包的资源就是chunk，输出出去叫bundle。</span><br><span class="line">    // chunk的name是啥呢？ 比如： entry中xxx: &quot;./src/xxx.js&quot;, name就是xxx。注意是前面的xxx，和文件名无关。</span><br><span class="line">    // 为什么需要这样命名呢？如果还是之前写法main.js，那么打包生成两个js文件都会叫做main.js会发生覆盖。(实际上会直接报错的)</span><br><span class="line">    filename: &quot;js/[name].js&quot;,</span><br><span class="line">    clean: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      template: &quot;./public/index.html&quot;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  mode: &quot;production&quot;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    // 代码分割配置</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: &quot;all&quot;, // 对所有模块都进行分割</span><br><span class="line">      // 以下是默认值</span><br><span class="line">      // minSize: 20000, // 分割代码最小的大小</span><br><span class="line">      // minRemainingSize: 0, // 类似于minSize，最后确保提取的文件大小不能为0</span><br><span class="line">      // minChunks: 1, // 至少被引用的次数，满足条件才会代码分割</span><br><span class="line">      // maxAsyncRequests: 30, // 按需加载时并行加载的文件的最大数量</span><br><span class="line">      // maxInitialRequests: 30, // 入口js文件最大并行请求数量</span><br><span class="line">      // enforceSizeThreshold: 50000, // 超过50kb一定会单独打包（此时会忽略minRemainingSize、maxAsyncRequests、maxInitialRequests）</span><br><span class="line">      // cacheGroups: &#123; // 组，哪些模块要打包到一个组</span><br><span class="line">      //   defaultVendors: &#123; // 组名</span><br><span class="line">      //     test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span><br><span class="line">      //     priority: -10, // 权重（越大越高）</span><br><span class="line">      //     reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span><br><span class="line">      //   &#125;,</span><br><span class="line">      //   default: &#123; // 其他没有写的配置会使用上面的默认值</span><br><span class="line">      //     minChunks: 2, // 这里的minChunks权重更大</span><br><span class="line">      //     priority: -20,</span><br><span class="line">      //     reuseExistingChunk: true,</span><br><span class="line">      //   &#125;,</span><br><span class="line">      // &#125;,</span><br><span class="line">      // 修改配置</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        // 组，哪些模块要打包到一个组</span><br><span class="line">        // defaultVendors: &#123; // 组名</span><br><span class="line">        //   test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span><br><span class="line">        //   priority: -10, // 权重（越大越高）</span><br><span class="line">        //   reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span><br><span class="line">        // &#125;,</span><br><span class="line">        default: &#123;</span><br><span class="line">          // 其他没有写的配置会使用上面的默认值</span><br><span class="line">          minSize: 0, // 我们定义的文件体积太小了，所以要改打包的最小文件体积</span><br><span class="line">          minChunks: 2,</span><br><span class="line">          priority: -20,</span><br><span class="line">          reuseExistingChunk: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>我们从 4 个角度对 webpack 和代码进行了优化：</p>
<ol>
<li>提升开发体验</li>
</ol>
<ul>
<li>  使用 <code>Source Map</code> 让开发或上线时代码报错能有更加准确的错误提示。</li>
</ul>
<ol start="2">
<li>提升 webpack 提升打包构建速度</li>
</ol>
<ul>
<li>  使用 <code>HotModuleReplacement</code> 让开发时只重新编译打包更新变化了的代码，不变的代码使用缓存，从而使更新速度更快。</li>
<li>  使用 <code>OneOf</code> 让资源文件一旦被某个 loader 处理了，就不会继续遍历了，打包速度更快。</li>
<li>  使用 <code>Include/Exclude</code> 排除或只检测某些文件，处理的文件更少，速度更快。</li>
<li>  使用 <code>Cache</code> 对 eslint 和 babel 处理的结果进行缓存，让第二次打包速度更快。</li>
<li>  使用 <code>Thead</code> 多进程处理 eslint 和 babel 任务，速度更快。（需要注意的是，进程启动通信都有开销的，要在比较多代码处理时使用才有效果）</li>
</ul>
<ol start="3">
<li>减少代码体积</li>
</ol>
<ul>
<li>  使用 <code>Tree Shaking</code> 剔除了没有使用的多余代码，让代码体积更小。</li>
<li>  使用 <code>@babel/plugin-transform-runtime</code> 插件对 babel 进行处理，让辅助代码从中引入，而不是每个文件都生成辅助代码，从而体积更小。</li>
<li>  使用 <code>Image Minimizer</code> 对项目中图片进行压缩，体积更小，请求速度更快。（需要注意的是，如果项目中图片都是在线链接，那么就不需要了。本地项目静态图片才需要进行压缩。）</li>
</ul>
<ol start="4">
<li>优化代码运行性能</li>
</ol>
<ul>
<li>  使用 <code>Code Split</code> 对代码进行分割成多个 js 文件，从而使单个文件体积更小，并行加载 js 速度更快。并通过 import 动态导入语法进行按需加载，从而达到需要使用时才加载该资源，不用时不加载资源。</li>
<li>  使用 <code>Preload / Prefetch</code> 对代码进行提前加载，等未来需要使用时就能直接使用，从而用户体验更好。</li>
<li>  使用 <code>Network Cache</code> 能对输出资源文件进行更好的命名，将来好做缓存，从而用户体验更好。</li>
<li>  使用 <code>Core-js</code> 对 js 进行兼容性处理，让我们代码能运行在低版本浏览器。</li>
<li>  使用 <code>PWA</code> 能让代码离线也能访问，从而提升用户体验。</li>
</ul>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Webpack/">Webpack</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/08/js/" title="JavaScript"><img class="cover" src="/assets/js.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">JavaScript</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/08/%E6%89%8B%E5%86%99/" title="常见手写"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">常见手写</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assets/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">zhper</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zhper" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content"><center>主域名：<br><a href="https://zhper.vercel.app/"><b><font color="#5ea6e5">zhper.vercel.app</font></b></center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7"><span class="toc-text">打包工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95"><span class="toc-text">项目目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96"><span class="toc-text">下载依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6"><span class="toc-text">创建文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-Webpack"><span class="toc-text">运行 Webpack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7"><span class="toc-text">基本属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%B8%85%E7%A9%BA%E8%BE%93%E5%87%BA%E7%9B%AE%E5%BD%95"><span class="toc-text">自动清空输出目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="toc-text">开发模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-text">运行流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%A0%B7%E5%BC%8F%E8%B5%84%E6%BA%90"><span class="toc-text">处理样式资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-CSS-%E8%B5%84%E6%BA%90"><span class="toc-text">处理 CSS 资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-Less-%E8%B5%84%E6%BA%90"><span class="toc-text">处理 Less 资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-Sass-Scss-%E8%B5%84%E6%BA%90"><span class="toc-text">处理 Sass&#x2F; Scss 资源</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90"><span class="toc-text">处理图片资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86"><span class="toc-text">处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-text">图片资源的优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90%E7%9A%84%E6%89%93%E5%8C%85%E8%B7%AF%E5%BE%84"><span class="toc-text">图片资源的打包路径</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%9F%B3%E8%A7%86%E9%A2%91%E7%AD%89%E8%B5%84%E6%BA%90"><span class="toc-text">处理音视频等资源</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86-JS-%E8%B5%84%E6%BA%90"><span class="toc-text">处理 JS 资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ESLint"><span class="toc-text">ESLint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ESLint-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">ESLint 配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESLint-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">ESLint 基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#parserOptions"><span class="toc-text">parserOptions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rules"><span class="toc-text">rules</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#extends"><span class="toc-text">extends</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#env"><span class="toc-text">env</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Webpack-%E4%B8%AD%E4%BD%BF%E7%94%A8-ESLint"><span class="toc-text">在 Webpack 中使用 ESLint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%BF%9B%E8%A1%8C-ESLint-%E6%A3%80%E6%9F%A5"><span class="toc-text">不进行 ESLint 检查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Babel"><span class="toc-text">Babel</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Babel-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">Babel 的配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Webpack-%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-text">在 Webpack 中使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86-HTML-%E8%B5%84%E6%BA%90"><span class="toc-text">处理 HTML 资源</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA-dev-server"><span class="toc-text">搭建 dev-server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96-1"><span class="toc-text">下载依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-text">运行</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-text">生产模式介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8B%86%E5%88%86"><span class="toc-text">配置拆分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E9%85%8D%E7%BD%AE"><span class="toc-text">详细配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%84%E7%90%86-CSS-%E8%B5%84%E6%BA%90-1"><span class="toc-text">处理 CSS 资源</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86-CSS-%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96%E4%B8%BA%E5%8D%95%E7%8B%AC%E6%96%87%E4%BB%B6"><span class="toc-text">将 CSS 资源提取为单独文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E5%A4%84%E7%90%86"><span class="toc-text">兼容性处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85-loader"><span class="toc-text">封装 loader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSS-%E5%8E%8B%E7%BC%A9"><span class="toc-text">CSS 压缩</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93"><span class="toc-text">生产模式总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C"><span class="toc-text">提升开发体验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-Map"><span class="toc-text">Source Map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SourceMap"><span class="toc-text">SourceMap</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E6%89%93%E5%8C%85%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6"><span class="toc-text">提升打包构建速度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hot-Module-Replacement"><span class="toc-text">Hot Module Replacement</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OneOf"><span class="toc-text">OneOf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InClude-Exclude"><span class="toc-text">InClude &#x2F; Exclude</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cache"><span class="toc-text">Cache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Thead"><span class="toc-text">Thead</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E4%BB%A3%E7%A0%81%E4%BD%93%E7%A7%AF"><span class="toc-text">减少代码体积</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tree-Shaking"><span class="toc-text">Tree Shaking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Babel-1"><span class="toc-text">Babel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Image-Minimizer"><span class="toc-text">Image Minimizer</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E6%80%A7%E8%83%BD"><span class="toc-text">优化代码运行性能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-Split"><span class="toc-text">Code Split</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/02/08/css/" title="CSS"><img src="/assets/css.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSS"/></a><div class="content"><a class="title" href="/2023/02/08/css/" title="CSS">CSS</a><time datetime="2023-02-07T16:00:00.000Z" title="Created 2023-02-08 00:00:00">2023-02-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/08/html/" title="HTML"><img src="/assets/html.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTML"/></a><div class="content"><a class="title" href="/2023/02/08/html/" title="HTML">HTML</a><time datetime="2023-02-07T16:00:00.000Z" title="Created 2023-02-08 00:00:00">2023-02-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/08/ts/" title="TypeScript"><img src="/assets/ts.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TypeScript"/></a><div class="content"><a class="title" href="/2023/02/08/ts/" title="TypeScript">TypeScript</a><time datetime="2023-02-07T16:00:00.000Z" title="Created 2023-02-08 00:00:00">2023-02-08</time></div></div></div></div></div></div></main><footer id="footer" style="background: rgb(118, 123, 126,0.1)"><div id="footer-wrap"><div class="copyright">&copy;2023 By zhper</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>